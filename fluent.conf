<source>
  @type tail
  path ./python.log
  pos_file ./python.log.pos
  tag python.country
  <parse>
    @type ltsv
  </parse>
</source>

<filter **>
  @type insert_id
</filter>

<filter **>
  @type record_transformer
  enable_ruby true
  <record>
    host "#{Socket.gethostname}"
  </record>
</filter>

<match python.*>
  @type file
  # Don't need to add '.log' since suffix is automatically added.
  path ./country/%Y/%m/%d/%H%M%S
  <buffer time>
    @type file
    timekey 10s
    timekey_wait 1s
    timekey_use_utc true
#    flush_mode immediate
#    flush_mode lazy
    flush_mode interval
    flush_interval 3s
  </buffer>
</match>

<match fluent.*>
  @type stdout
</match>
